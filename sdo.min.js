/* simple data objects - http://github.com/darthapo/sdo.js */
(function(){var t,n,e,r,i,o,s,h,a,u,l={}.hasOwnProperty,f=[].indexOf||function(t){for(var n=0,e=this.length;e>n;n++)if(n in this&&this[n]===t)return n;return-1},p=function(t,n){return function(){return t.apply(n,arguments)}},c=function(t,n){function e(){this.constructor=t}for(var r in n)l.call(n,r)&&(t[r]=n[r]);return e.prototype=n.prototype,t.prototype=new e,t.__super__=n.prototype,t};h=this,a=Array.prototype.slice,u=Object.prototype.toString,o=function(){var t,n,e,r,i,o;for(n=/\[object HTML(.*)\]/,t={},o="Array Boolean Date Function NodeList Null Number RegExp String Undefined ".split(" "),r=0,i=o.length;i>r;r++)e=o[r],t["[object "+e+"]"]=e.toLowerCase();return function(e){var r,i;return i=u.call(e),(r=t[i])?r:(r=i.match(n))?r[1].toLowerCase():"object"}}(),s=function(){var t,n;return t=0,n=36,function(){var e;for(e=(new Date).getTime();t>=e;)e+=1;return t=e,e.toString(n)}}(),i=function(){var t;return t=("undefined"!=typeof module&&null!==module?module.exports:void 0)||h,function(n){var e,r,i;i=[];for(e in n)if(l.call(n,e)){if(r=n[e],f.call(t,e)>=0)throw new Error(""+e+" already exists!");i.push(t[e]=r)}return i}}(),e=function(){function t(){this._notifyChange=p(this._notifyChange,this)}return t.prototype.onChange=function(t,n){var e;return null==this._listeners&&(this._listeners=[]),n?this._listeners=null!=t?function(){var n,r,i,o;for(i=this._listeners,o=[],n=0,r=i.length;r>n;n++)e=i[n],e!==t&&o.push(e);return o}.call(this):[]:f.call(this._listeners,t)<0?this._listeners.push(t):void 0},t.prototype._notifyChange=function(t){var n,e,r,i,o;if(!(this._listeners&&this._listeners.length>0))return null;for(i=this._listeners,o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push(n(t,this));return o},t}(),i({uid:s,type:o}),t=function(t){function n(t,e){return this===h?new n(t,e):(n.__super__.constructor.apply(this,arguments),this._atts={},t&&(t instanceof n?this.set(t._atts):"object"===o(t)&&this.set(t)),e&&this.onChange(e),void 0)}return c(n,t),n.prototype.set=function(t,n,e){return 2===arguments.length?this._setPair(t,n,e):this._setObject(t,e)},n.prototype.replace=function(t,n,e){return this.remove(t,e,!0),this.set(t,n,e)},n.prototype.get=function(t){var n,e,r;if(1===arguments.length)return this._atts[t];n={},r=this._atts;for(t in r)e=r[t],n[t]=(null!=e?"function"==typeof e.get?e.get():void 0:void 0)||e;return n},n.prototype.remove=function(t,n,e){var r;return r=this.get(t),void 0!==r&&(null!=r&&"function"==typeof r.onChange&&r.onChange(this._notifyChange,!1),e||delete this._atts[t],n||this._notifyChange([t])),r},n.prototype._setPair=function(t,n,e){return n!==this._atts[t]?(this.remove(t,!0,!0),this._atts[t]=n,e||this._notifyChange([t]),null!=n&&"function"==typeof n.onChange&&n.onChange(this._notifyChange),!0):!1},n.prototype._setObject=function(t,n){var e,r,i;r=[];for(e in t)l.call(t,e)&&(i=t[e],this._setPair(e,i,!0)&&r.push(e));return r.length>0?(n||this._notifyChange(r),!0):!1},n}(e),i({Hash:t}),n=function(t){function n(t,e){return this===h?new n(t,e):(n.__super__.constructor.apply(this,arguments),this._list=[],this.length=0,t&&("array"===o(t)?this.addAll(t):this.add(t)),e&&this.onChange(e),void 0)}return c(n,t),n.prototype.add=function(t,n){return this._list.push(t),null!=t&&"function"==typeof t.onChange&&t.onChange(this._notifyChange),this.length=this._list.length,n||this._notifyChange("add"),this},n.prototype.addAll=function(t,n){var e,r,i;for(r=0,i=t.length;i>r;r++)e=t[r],this.add(e,n);return this},n.prototype.remove=function(t,n){var e;return e=this.get(t),this._list.splice(t,1),null!=e&&"function"==typeof e.onChange&&e.onChange(this._notifyChange,!0),this.length=this._list.length,n||this._notifyChange("remove"),this},n.prototype.get=function(t){var n,e,r,i,o;if(0===arguments.length){for(i=this._list,o=[],e=0,r=i.length;r>e;e++)n=i[e],o.push((null!=n?"function"==typeof n.get?n.get():void 0:void 0)||n);return o}return this._list[t]},n.prototype.items=function(){return this._list},n.prototype.clear=function(t){var n,e,r,i;for(i=this._list,e=0,r=i.length;r>e;e++)n=i[e],this.remove(n,!0);return t||this._notifyChange("clear"),this},n}(e),i({List:n}),r=function(){function e(t,n){if(this.storageKey=t,this.backend=null!=n?n:window.localStorage,this.load=p(this.load,this),this.save=p(this.save,this),void 0!==r[this.storageKey])return r[this.storageKey];if(this===h)return new e(this.storageKey,this.backend);if(null==this.storageKey)throw new Error("Can't persist with a storage key.");if(null==this.backend)throw new Error("Can't persist on this platform.");return r[this.storageKey]=this}var r;return r={},e.prototype.save=function(t,n){var e;return e=n.get(),this.backend.setItem(this.storageKey,JSON.stringify(e))},e.prototype.load=function(t){var n,e;return null==t&&(t={}),e=this.backend.getItem(this.storageKey),null!=e?(n=JSON.parse(e),this.parse(n)):this.parse(t)},e.prototype.parse=function(e){var r,i,s,h,a,u,f;if("array"===o(e)){for(h=[],u=0,f=e.length;f>u;u++)i=e[u],h.push(this.parse(i));return n(h)}if("object"===o(e)){r={};for(s in e)l.call(e,s)&&(a=e[s],r[s]=this.parse(a));return t(r)}return e},e}(),i({Store:r})}).call(this);